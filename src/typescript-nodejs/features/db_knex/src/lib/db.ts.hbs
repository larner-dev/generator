import knex from "knex";
import { secrets } from "./secrets";

const { DB_HOST, DB_PORT, DB_USER, DB_PASSWORD, DB_NAME } = await secrets();

export const db = knex({
  client: "{{ db_knex_dialect }}",
  connection: {
    host: DB_HOST,
    port: parseInt(DB_PORT),
    user: DB_USER,
    password: DB_PASSWORD,
    database: DB_NAME,
    ssl:
      process.env.NODE_ENV !== "development"
        ? { rejectUnauthorized: false }
        : false,
  },
});
